{% load custom_filters %}

<div class="col-lg-12">
  <div class="row">

    <!-- ðŸ§« RETEST DISK DIFFUSION -->
    <div class="col-lg-5">
      <h6 class="heading-small text-muted mb-4">RETEST â€“ DISK DIFFUSION ({{ breakpoint_year|default:"Latest" }})</h6>
      <div class="card border-info mb-3">
        <div class="card-body text-info">
          <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
            <table class="table align-items-center text-center table-sm table-responsive" style="width: 100%;">
              <thead class="thead-light">
                <tr style="line-height: 15px;">
                  <th>ANTIBIOTIC</th>
                  <th>TEST METHOD</th>
                  <th>WHONET CODE</th>
                  <th>TEST RESULT</th>
                  <th>RIS</th>
                </tr>
              </thead>
              <tbody>
                {% if whonet_retest_data %}
                  {% for retest in whonet_retest_data|dictsort:"Whonet_Abx" %}
                    {% if retest.Disk_Abx %}
                      <tr>
                        <td>{{ retest.Antibiotic }}</td>
                        <td>Disk</td>
                        <td>{{ retest.Whonet_Abx }}</td>
                        <td>
                          <input name="retest_disk_{{ retest.Whonet_Abx }}"
                                 value="{% get_existing_value retest_entries retest.Whonet_Abx 'retest_disk' %}"
                                 type="number" min="0" style="width: 70px;">
                        </td>
                        <td>
                          <input name="retest_disk_enris_{{ retest.Whonet_Abx }}"
                                 value="{% get_existing_value retest_entries retest.Whonet_Abx 'retest_disk_enris' %}"
                                 type="text" style="width: 50px;">
                        </td>
                      </tr>
                    {% endif %}
                  {% endfor %}
                {% else %}
                  <tr><td colspan="5">No retest disk antibiotics available</td></tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- ðŸ’§ RETEST MIC RESULTS -->
    <div class="col-lg-7">
      <h6 class="heading-small text-muted mb-4">RETEST â€“ MIC RESULTS ({{ breakpoint_year|default:"Latest" }})</h6>
      <div class="card border-info mb-3">
        <div class="card-body text-info">
          <div class="table-responsive" style="max-height: 500px; overflow-y: auto;">
            <table class="table align-items-center text-center table-sm table-responsive" style="width: 100%;">
              <thead class="thead-light">
                <tr style="line-height: 15px;">
                  <th>ANTIBIOTIC</th>
                  <th>TEST METHOD</th>
                  <th>WHONET CODE</th>
                  <th>OPERAND</th>
                  <th>TEST RESULT</th>
                  <th>RIS</th>
                  <th>ALERT MIC</th>
                </tr>
              </thead>
              <tbody>
                {% if whonet_retest_data %}
                  {% for retest in whonet_retest_data|dictsort:"Whonet_Abx" %}
                    {% if not retest.Disk_Abx %}
                      <tr>
                        <td>{{ retest.Antibiotic }}</td>
                        <td>MIC</td>
                        <td>{{ retest.Whonet_Abx }}</td>
                        <td>
                          <input name="retest_mic_operand_{{ retest.Whonet_Abx }}"
                                 value="{% get_existing_value retest_entries retest.Whonet_Abx 'retest_mic_operand' %}"
                                 type="text" style="width: 50px;">
                        </td>
                        <td>
                          <input name="retest_mic_{{ retest.Whonet_Abx }}"
                                 value="{% get_existing_value retest_entries retest.Whonet_Abx 'retest_mic' %}"
                                 type="number" min="0" step="0.001" style="width: 70px;">
                        </td>
                        <td>
                          <input name="retest_mic_enris_{{ retest.Whonet_Abx }}"
                                 value="{% get_existing_value retest_entries retest.Whonet_Abx 'retest_mic_enris' %}"
                                 type="text" style="width: 50px;">
                        </td>
                        <td>
                          {% get_existing_value retest_entries retest.Whonet_Abx 'retest_alert_mic' as retest_alert_mic_checked %}
                          <input type="checkbox"
                                 name="retest_alert_mic_{{ retest.Whonet_Abx }}"
                                 style="transform: scale(1.5); margin: 4px;"
                                 {% if retest_alert_mic_checked %}checked{% endif %}>
                        </td>
                      </tr>
                    {% endif %}
                  {% endfor %}
                {% else %}
                  <tr><td colspan="7">No retest MIC antibiotics available</td></tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
